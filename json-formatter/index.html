<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JSON Formatter & Viewer</title>
    <style>
      :root {
        --bg: #0f172a;
        --panel: #111827;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --accent: #22d3ee;
        --danger: #f87171;
        --border: #1f2937;
        --ok: #34d399;
        --shadow: 0 6px 20px rgba(0,0,0,.35);
        --radius: 10px;
        --font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        --footer-h: 72px;
      }
      [data-theme="light"] {
        --bg: #f6f7fb;
        --panel: #ffffff;
        --text: #0f172a;
        --muted: #6b7280;
        --accent: #0ea5e9;
        --danger: #dc2626;
        --border: #e5e7eb;
        --ok: #059669;
        --shadow: 0 8px 24px rgba(0,0,0,.08);
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        line-height: 1.4;
      }
      .page {
        display: grid;
        grid-template-rows: auto 1fr;
        min-height: 100vh;
        gap: 14px;
        padding: 16px;
        padding-bottom: var(--footer-h);
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .title {
        font-weight: 700;
        font-size: 18px;
        letter-spacing: .2px;
      }
      .toolbar {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
      }
      .btn {
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        transition: transform .05s ease, background .2s ease, border-color .2s ease;
        box-shadow: var(--shadow);
        user-select: none;
        font-weight: 600;
      }
      .btn:hover { border-color: var(--accent); }
      .btn:active { transform: translateY(1px); }
      .btn.primary { background: linear-gradient(180deg, rgba(34,211,238,.15), rgba(34,211,238,.05)); border-color: rgba(34,211,238,.4); }
      .btn.ok { background: linear-gradient(180deg, rgba(52,211,153,.15), rgba(52,211,153,.05)); border-color: rgba(52,211,153,.4); }
      .btn.danger { background: linear-gradient(180deg, rgba(248,113,113,.15), rgba(248,113,113,.05)); border-color: rgba(248,113,113,.4); }
      .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
      .icon-btn {
        width: 38px;
        height: 38px;
        border-radius: 10px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        box-shadow: var(--shadow);
        cursor: pointer;
        transition: transform .05s ease, filter .2s ease, border-color .2s ease, background .2s ease;
      }
      .icon-btn svg { width: 18px; height: 18px; display: block; fill: currentColor; }
      .icon-btn:hover { transform: translateY(1px); filter: brightness(1.08); }
      .icon-load { color: #0ea5e9; background: rgba(14,165,233,.12); border-color: rgba(14,165,233,.4); }
      .icon-save { color: #22c55e; background: rgba(34,197,94,.12); border-color: rgba(34,197,94,.4); }
      .icon-copy { color: #06b6d4; background: rgba(6,182,212,.12); border-color: rgba(6,182,212,.4); }
      .icon-paste { color: #f59e0b; background: rgba(245,158,11,.12); border-color: rgba(245,158,11,.4); }
      .icon-theme { color: #8b5cf6; background: rgba(139,92,246,.12); border-color: rgba(139,92,246,.4); }
      .icon-full { color: #94a3b8; background: rgba(148,163,184,.12); border-color: rgba(148,163,184,.4); }
      .icon-settings { color: #fb7185; background: rgba(251,113,133,.12); border-color: rgba(251,113,133,.4); }
      .seg {
        display: inline-flex;
        border: 1px solid var(--border);
        border-radius: 10px;
        overflow: hidden;
        background: var(--panel);
        box-shadow: var(--shadow);
      }
      .seg > button { border: none; border-right: 1px solid var(--border); }
      .seg > button:last-child { border-right: none; }
      .opt {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border: 1px solid var(--border);
        background: var(--panel);
        border-radius: 8px;
        box-shadow: var(--shadow);
      }
      select, input[type="checkbox"] {
        accent-color: var(--accent);
      }
      .workspace {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        min-height: 0;
        height: 100%;
      }
      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        min-height: 0;
      }
      .card > .card-header {
        padding: 10px 12px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .card > .card-body {
        padding: 0;
        min-height: 0;
        display: flex;
        flex-direction: column;
        flex: 1;
      }
      textarea#input {
        flex: 1;
        width: 100%;
        height: 100%;
        min-height: 300px;
        border: none;
        outline: none;
        resize: none;
        padding: 14px 16px;
        font-family: var(--font);
        font-size: 13px;
        line-height: 1.5;
        background: transparent;
        color: var(--text);
        tab-size: 2;
      }
      .drop-hint {
        font-size: 12px;
        color: var(--muted);
        padding: 8px 12px;
        border-top: 1px dashed var(--border);
      }
      .status {
        padding: 8px 12px;
        font-size: 12px;
        border-top: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      }
      .status.ok { color: var(--ok); }
      .status.err { color: var(--danger); }
      .tabs { display: flex; gap: 6px; }
      .tabs button {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: transparent;
        color: var(--text);
        cursor: pointer;
      }
      .tabs button.active { background: rgba(34,211,238,.12); border-color: rgba(34,211,238,.4); }
      .viewer {
        position: relative;
        overflow: auto;
        padding: 8px 12px 12px 12px;
        flex: 1;
        min-height: 0;
        font-family: var(--font);
        display: flex;
        flex-direction: column;
      }
      #viewer-edit { height: calc(100vh - 160px - var(--footer-h)); }
      pre#raw {
        margin: 0;
        white-space: pre;
        font-size: 13px;
      }
      .tree { font-family: var(--font); font-size: 13px; }
      .tree ul { list-style: none; padding-left: 18px; margin: 0; }
      .tree li { position: relative; margin: 2px 0; }
      .caret { cursor: pointer; display: inline-flex; align-items: center; justify-content: center; width: 16px; height: 16px; border-radius: 4px; margin-right: 6px; color: var(--muted); }
      .caret:hover { background: rgba(255,255,255,.05); color: var(--accent); }
      .caret::before { content: "▸"; display: inline-block; transition: transform .15s ease; font-size: 10px; }
      .expanded > .node > .caret::before { transform: rotate(90deg); }
      .children { display: none; border-left: 1px dashed var(--border); margin-left: 7px; padding-left: 10px; }
      .expanded > .children { display: block; }
      .key { color: var(--color-key, #93c5fd); }
      .type-string { color: var(--color-string, #fbbf24); }
      .type-number { color: var(--color-number, #f472b6); }
      .type-boolean { color: var(--color-boolean, #34d399); }
      .type-null { color: var(--color-null, #a3a3a3); font-style: italic; }
      .dim { color: var(--muted); }
      .badge { color: var(--muted); font-size: 11px; border: 1px solid var(--border); padding: 1px 6px; border-radius: 999px; margin-left: 6px; }
      .node { display: inline-flex; align-items: center; gap: 2px; }
      .footer {
        color: var(--muted);
        font-size: 12px;
        display: flex;
        justify-content: space-between;
        gap: 8px;
        align-items: center;
        height: var(--footer-h);
        padding: 12px 16px;
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--panel);
        border-top: 1px solid var(--border);
        z-index: 900;
      }
      .kbd { border: 1px solid var(--border); padding: 0 6px; border-radius: 4px; background: rgba(255,255,255,.03); font-family: var(--font); font-size: 12px; }
      .hidden { display: none !important; }
      @media (max-width: 1200px) { .workspace { grid-template-columns: 1fr; } }

      /* Ayarlar modalı */
      .settings-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .settings-dialog {
        width: 640px;
        max-width: calc(100vw - 32px);
        background: var(--panel);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: var(--shadow);
        padding: 16px;
      }
      .settings-title { font-weight: 700; margin: 4px 0 12px 0; font-size: 16px; }
      .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      .form-row { display: flex; flex-direction: column; gap: 6px; }
      .form-row label { font-size: 12px; color: var(--muted); }
      .form-row input[type="number"], .form-row select {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: transparent;
        color: var(--text);
      }
      .palette-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; }
      .palette {
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 8px;
        background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02));
        cursor: pointer;
      }
      .palette.active { outline: 2px solid var(--accent); }
      .palette-name { font-size: 12px; color: var(--muted); margin-bottom: 6px; }
      .swatches { display: flex; gap: 4px; }
      .sw { width: 14px; height: 14px; border-radius: 3px; border: 1px solid var(--border); }
      .settings-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 14px; }

      /* Hızlı palet açılır menü */
      .card-header-right { display: flex; align-items: center; gap: 10px; }
      .quick-palette { position: relative; }
      .qp-btn { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--panel); color: var(--text); cursor: pointer; }
      .qp-swatches-inline { display: inline-flex; gap: 3px; }
      .qp-sw { width: 12px; height: 12px; border-radius: 3px; border: 1px solid var(--border); }
      .qp-menu { position: absolute; right: 0; top: calc(100% + 6px); background: var(--panel); border: 1px solid var(--border); border-radius: 10px; box-shadow: var(--shadow); padding: 8px; width: 280px; z-index: 1500; }
      .qp-list { display: grid; grid-template-columns: 1fr; gap: 6px; max-height: 300px; overflow: auto; }
      .qp-item { display: flex; align-items: center; justify-content: space-between; gap: 8px; padding: 8px 10px; border: 1px solid var(--border); border-radius: 8px; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02)); cursor: pointer; }
      .qp-item:hover { border-color: var(--accent); }
      .qp-name { font-size: 12px; color: var(--muted); }

      /* Yumuşak tam ekran (yalnızca JSON kartı) */
      .body-soft-full header, .body-soft-full .footer { display: none; }
      #mainCard.fullscreen-card {
        position: fixed;
        inset: 8px;
        z-index: 2000;
      }
    </style>
  </head>
  <body>
    <div class="page" id="page">
      <header>
        <div class="title">JSON Formatter & Viewer</div>
        <div class="toolbar">
          <div class="seg" role="group" aria-label="Biçimlendirme">
            <button class="btn primary" id="btnFormat" title="Biçimlendir (Ctrl+Enter)">Biçimlendir</button>
            <button class="btn" id="btnMinify" title="Sıkıştır (Minify)">Sıkıştır</button>
            <button class="btn" id="btnValidate" title="Doğrula">Doğrula</button>
          </div>
          <div class="seg" role="group" aria-label="Ağaç">
            <button class="btn" id="btnExpand">Genişlet</button>
            <button class="btn" id="btnCollapse">Daralt</button>
          </div>
          <div class="opt">
            <label for="indent">Girinti:</label>
            <select id="indent" title="Girinti">
              <option value="2">2 boşluk</option>
              <option value="4">4 boşluk</option>
              <option value="\t">Sekme</option>
            </select>
            <label style="margin-left:10px; display:inline-flex; align-items:center; gap:6px;">
              <input type="checkbox" id="sortKeys"> Anahtarları sırala
            </label>
          </div>
          <div class="seg" role="group" aria-label="Dosya">
            <button class="icon-btn icon-load" id="btnLoad" aria-label="Yükle" title="JSON Yükle">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3a1 1 0 0 1 1 1v8.586l2.293-2.293a1 1 0 1 1 1.414 1.414l-4.007 4.007a1.25 1.25 0 0 1-1.707 0L6.986 11.707a1 1 0 0 1 1.414-1.414L10.707 12.6V4a1 1 0 0 1 1-1z"></path><path d="M5 19a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-2a1 1 0 1 0-2 0v2H7v-2a1 1 0 1 0-2 0v2z"></path></svg>
            </button>
            <button class="icon-btn icon-save" id="btnSave" aria-label="Kaydet" title="JSON Kaydet">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 3h10l4 4v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm8 2H7v6h6V5z"></path></svg>
            </button>
            <button class="icon-btn icon-copy" id="btnCopy" aria-label="Kopyala" title="Kopyala">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M16 1H6a2 2 0 0 0-2 2v12h2V3h10V1z"></path><path d="M8 5h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2zm0 2v12h10V7H8z"></path></svg>
            </button>
            <button class="icon-btn icon-paste" id="btnPaste" aria-label="Yapıştır" title="Yapıştır">
              <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19 4h-3.18A3 3 0 0 0 13 2h-2a3 3 0 0 0-2.82 2H5a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2h6v-2H5V6h2v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6h2v5h2V6a2 2 0 0 0-2-2zM9 5a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1z"></path><path d="M21 13h-6a2 2 0 0 0-2 2v6h8a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2zm-6 8v-6h6v4h-4v2h-2z"></path></svg>
            </button>
          </div>
          <button class="icon-btn icon-theme" id="btnTheme" aria-label="Tema" title="Tema">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 1 0 21 12.79z"></path></svg>
          </button>
          <button class="icon-btn icon-full" id="btnFull" aria-label="Tam Ekran" title="JSON tam ekran">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 3H3v5h2V5h3V3zm10 0h-5v2h3v3h2V3zM5 16H3v5h5v-2H5v-3zm16 0h-2v3h-3v2h5v-5z"></path></svg>
          </button>
          <button class="icon-btn icon-settings" id="btnSettings" aria-label="Ayarlar" title="Ayarlar">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8zm8.94 4a7.97 7.97 0 0 0-.14-1.52l2.02-1.57-1.9-3.29-2.41.78a8.03 8.03 0 0 0-2.64-1.53l-.4-2.51H9.53l-.4 2.51a8.03 8.03 0 0 0-2.64 1.53l-2.41-.78-1.9 3.29 2.02 1.57A7.97 7.97 0 0 0 3.06 12c0 .52.05 1.03.14 1.52l-2.02 1.57 1.9 3.29 2.41-.78c.78.64 1.67 1.16 2.64 1.53l.4 2.51h4.64l.4-2.51c.97-.37 1.86-.89 2.64-1.53l2.41.78 1.9-3.29-2.02-1.57c.09-.49.14-1 .14-1.52z"></path></svg>
          </button>
          <input class="hidden" type="file" id="fileInput" accept="application/json,.json,text/json,text/plain">
        </div>
      </header>

      <div class="workspace">
        <section class="card" id="mainCard">
          <div class="card-header">
            <div class="tabs">
              <button class="tab-btn active" data-tab="edit">Düzenle</button>
              <button class="tab-btn" data-tab="tree">Ağaç</button>
              <button class="tab-btn" data-tab="raw">Ham</button>
            </div>
            <div class="card-header-right">
              <div class="dim">Sürükle-bırak desteklenir</div>
              <div class="quick-palette" id="quickPalette">
                <button class="qp-btn" id="qpToggle" aria-haspopup="true" aria-expanded="false" title="Renk paleti seç">
                  <span class="qp-label">Palet</span>
                  <span class="qp-swatches-inline" id="qpSwatches"></span>
                </button>
                <div class="qp-menu hidden" id="qpMenu" role="menu">
                  <div class="qp-list" id="qpList"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="viewer" id="viewer-edit">
              <textarea id="input" spellcheck="false" placeholder='{"hello":"world"}'></textarea>
            </div>
            <div class="viewer hidden" id="viewer-tree">
              <div class="tree" id="tree"></div>
            </div>
            <div class="viewer hidden" id="viewer-raw">
              <pre id="raw"></pre>
            </div>
            <div class="status" id="status">Hazır</div>
            <div class="drop-hint" id="dropHint">JSON dosyasını bu alana sürükleyip bırakabilirsiniz.</div>
          </div>
        </section>
      </div>

      <div class="footer">
        <div>
          İşlemler tamamen tarayıcınızda gerçekleşir; veri dışarı gönderilmez. İlham alınan araç: <a href="https://jsonviewer.stack.hu/" target="_blank" rel="noopener" style="color:var(--accent); text-decoration:none;">jsonviewer.stack.hu</a>
        </div>
        <div>
          Kısayol: <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> → Biçimlendir
        </div>
      </div>
      
      <!-- Ayarlar Modal -->
      <div id="settingsModal" class="settings-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
        <div class="settings-dialog">
          <div class="settings-title" id="settingsTitle">Ayarlar</div>
          <div class="settings-grid">
            <div class="form-row">
              <label for="maxDepth">Maksimum Derinlik</label>
              <input type="number" id="maxDepth" min="1" max="100" value="32">
            </div>
            <div class="form-row">
              <label for="maxSizeKB">Maksimum Boyut (KB)</label>
              <input type="number" id="maxSizeKB" min="10" max="51200" value="2048">
            </div>
            <div class="form-row">
              <label for="rememberSession"><input type="checkbox" id="rememberSession"> Son oturumu hatırla</label>
            </div>
            <div class="form-row">
              <label for="paletteSelect">Renk Paleti</label>
              <select id="paletteSelect"></select>
            </div>
          </div>
          <div class="form-row" style="margin-top:8px;">
            <label>Palet Önizleme</label>
            <div class="palette-grid" id="paletteGrid"></div>
          </div>
          <div class="settings-actions">
            <button class="btn" id="btnCloseSettings">İptal</button>
            <button class="btn ok" id="btnSaveSettings">Kaydet</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const dom = {
          page: document.getElementById('page'),
          input: document.getElementById('input'),
          status: document.getElementById('status'),
          btnFormat: document.getElementById('btnFormat'),
          btnMinify: document.getElementById('btnMinify'),
          btnValidate: document.getElementById('btnValidate'),
          btnExpand: document.getElementById('btnExpand'),
          btnCollapse: document.getElementById('btnCollapse'),
          btnLoad: document.getElementById('btnLoad'),
          btnSave: document.getElementById('btnSave'),
          btnCopy: document.getElementById('btnCopy'),
          btnPaste: document.getElementById('btnPaste'),
          btnTheme: document.getElementById('btnTheme'),
          btnSettings: document.getElementById('btnSettings'),
          fileInput: document.getElementById('fileInput'),
          indent: document.getElementById('indent'),
          sortKeys: document.getElementById('sortKeys'),
          raw: document.getElementById('raw'),
          tree: document.getElementById('tree'),
          viewerEdit: document.getElementById('viewer-edit'),
          viewerTree: document.getElementById('viewer-tree'),
          viewerRaw: document.getElementById('viewer-raw'),
          tabs: Array.from(document.querySelectorAll('.tab-btn')),
          btnFull: document.getElementById('btnFull'),
          mainCard: document.getElementById('mainCard'),
          settingsModal: document.getElementById('settingsModal'),
          paletteSelect: document.getElementById('paletteSelect'),
          paletteGrid: document.getElementById('paletteGrid'),
          qpToggle: document.getElementById('qpToggle'),
          qpMenu: document.getElementById('qpMenu'),
          qpList: document.getElementById('qpList'),
          qpSwatches: document.getElementById('qpSwatches'),
          inpMaxDepth: document.getElementById('maxDepth'),
          inpMaxSizeKB: document.getElementById('maxSizeKB'),
          rememberSession: document.getElementById('rememberSession'),
          btnCloseSettings: document.getElementById('btnCloseSettings'),
          btnSaveSettings: document.getElementById('btnSaveSettings'),
        };

        // Tema
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
        dom.btnTheme.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', current);
          localStorage.setItem('theme', current);
        });

        // Renk paletleri
        const colorPalettes = {
          classic: { name: 'Klasik', key: '#93c5fd', string: '#fbbf24', number: '#f472b6', boolean: '#34d399', null: '#a3a3a3' },
          ocean:   { name: 'Okyanus', key: '#38bdf8', string: '#a7f3d0', number: '#7dd3fc', boolean: '#60a5fa', null: '#94a3b8' },
          sunset:  { name: 'Gün Batımı', key: '#fb7185', string: '#f59e0b', number: '#f472b6', boolean: '#84cc16', null: '#a3a3a3' },
          cyber:   { name: 'Cyberpunk', key: '#22d3ee', string: '#f0abfc', number: '#f97316', boolean: '#a3e635', null: '#9ca3af' },
          forest:  { name: 'Orman', key: '#86efac', string: '#fde68a', number: '#93c5fd', boolean: '#34d399', null: '#a3a3a3' },
          light:   { name: 'Açık', key: '#2563eb', string: '#059669', number: '#b45309', boolean: '#047857', null: '#6b7280' },
          solar:   { name: 'Solar', key: '#b58900', string: '#2aa198', number: '#cb4b16', boolean: '#859900', null: '#657b83' },
          pastel:  { name: 'Pastel', key: '#7c7cf5', string: '#ffb3ba', number: '#bae1ff', boolean: '#baffc9', null: '#cfcfcf' },
          neon:    { name: 'Neon', key: '#39ff14', string: '#ff2079', number: '#00e5ff', boolean: '#ffe700', null: '#bbbbbb' },
          grayscale: { name: 'Gri Ton', key: '#9ca3af', string: '#d1d5db', number: '#a3a3a3', boolean: '#e5e7eb', null: '#6b7280' },
        };

        const defaultSettings = {
          maxDepth: 32,
          maxSizeKB: 2048,
          palette: 'classic',
          rememberSession: true,
          indent: '2',
          sortKeys: false,
          lastInput: ''
        };
        let settings = loadSettings();
        applyPalette(settings.palette);
        populatePaletteUI();
        hydrateControlsFromSettings();
        buildQuickPalette();

        // Sekmeler (tek kart)
        dom.tabs.forEach(btn => btn.addEventListener('click', () => {
          dom.tabs.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const tab = btn.getAttribute('data-tab');
          dom.viewerEdit.classList.toggle('hidden', tab !== 'edit');
          dom.viewerTree.classList.toggle('hidden', tab !== 'tree');
          dom.viewerRaw.classList.toggle('hidden', tab !== 'raw');
          if (tab !== 'edit') formatAction(false);
        }));

        function setStatusOk(message) {
          dom.status.classList.remove('err');
          dom.status.classList.add('ok');
          dom.status.textContent = message;
        }
        function setStatusErr(message) {
          dom.status.classList.remove('ok');
          dom.status.classList.add('err');
          dom.status.textContent = message;
        }

        function parseJsonSafely(text) {
          try {
            const value = JSON.parse(text);
            return { ok: true, value };
          } catch (error) {
            const msg = String(error && error.message ? error.message : error);
            let position = null, line = null, column = null;
            const match = msg.match(/position\s+(\d+)/i);
            if (match) {
              position = Number(match[1]);
              const lc = positionToLineColumn(text, position);
              line = lc.line; column = lc.column;
            }
            return { ok: false, error: msg, position, line, column };
          }
        }

        function positionToLineColumn(text, pos) {
          let line = 1, column = 1;
          for (let i = 0; i < text.length && i < pos; i++) {
            const ch = text.charAt(i);
            if (ch === '\n') { line++; column = 1; }
            else { column++; }
          }
          return { line, column };
        }

        function getSizeKB(text) {
          try { return Math.ceil(new Blob([text]).size / 1024); } catch { return Math.ceil(text.length / 1024); }
        }

        function exceedsMaxSize(text) {
          const kb = getSizeKB(text);
          if (kb > settings.maxSizeKB) {
            setStatusErr(`Boyut sınırı aşıldı: ${kb}KB > ${settings.maxSizeKB}KB`);
            return true;
          }
          return false;
        }

        function exceedsMaxDepth(value, limit) {
          function walk(v, depth) {
            if (depth > limit) return true;
            if (!v || typeof v !== 'object') return false;
            if (Array.isArray(v)) {
              for (let i = 0; i < v.length; i++) { if (walk(v[i], depth + 1)) return true; }
              return false;
            }
            const keys = Object.keys(v);
            for (let i = 0; i < keys.length; i++) { if (walk(v[keys[i]], depth + 1)) return true; }
            return false;
          }
          return walk(value, 1);
        }

        function sortKeysDeep(value) {
          if (Array.isArray(value)) {
            return value.map(sortKeysDeep);
          }
          if (value && typeof value === 'object' && value.constructor === Object) {
            const sorted = {};
            Object.keys(value).sort().forEach(k => { sorted[k] = sortKeysDeep(value[k]); });
            return sorted;
          }
          return value;
        }

        function stringify(value, space, sort) {
          const v = sort ? sortKeysDeep(value) : value;
          return JSON.stringify(v, null, space);
        }

        function formatAction(replaceInput = true) {
          const text = dom.input.value.trim();
          if (exceedsMaxSize(text)) return;
          if (!text) { setStatusOk('Boş girdi.'); dom.tree.innerHTML = ''; dom.raw.textContent = ''; return; }
          const result = parseJsonSafely(text);
          if (!result.ok) {
            const where = (result.line && result.column) ? ` (satır ${result.line}, sütun ${result.column})` : '';
            setStatusErr(`JSON hatası${where}: ${result.error}`);
            return;
          }
          if (exceedsMaxDepth(result.value, settings.maxDepth)) {
            setStatusErr(`Derinlik sınırı aşıldı: > ${settings.maxDepth}`);
            return;
          }
          const space = dom.indent.value === '\t' ? '\t' : Number(dom.indent.value);
          const pretty = stringify(result.value, space, dom.sortKeys.checked);
          if (replaceInput) dom.input.value = pretty;
          dom.raw.textContent = pretty;
          renderTree(result.value);
          if (settings.rememberSession) { settings.lastInput = dom.input.value; saveSettings(); }
          setStatusOk('Biçimlendirme başarılı.');
        }

        function minifyAction() {
          const text = dom.input.value.trim();
          if (exceedsMaxSize(text)) return;
          if (!text) { setStatusOk('Boş girdi.'); return; }
          const result = parseJsonSafely(text);
          if (!result.ok) {
            const where = (result.line && result.column) ? ` (satır ${result.line}, sütun ${result.column})` : '';
            setStatusErr(`JSON hatası${where}: ${result.error}`);
            return;
          }
          if (exceedsMaxDepth(result.value, settings.maxDepth)) { setStatusErr(`Derinlik sınırı aşıldı: > ${settings.maxDepth}`); return; }
          const minified = stringify(result.value, 0, dom.sortKeys.checked);
          dom.input.value = minified;
          dom.raw.textContent = minified;
          renderTree(result.value);
          if (settings.rememberSession) { settings.lastInput = dom.input.value; saveSettings(); }
          setStatusOk('Sıkıştırma başarılı.');
        }

        function validateAction() {
          const text = dom.input.value.trim();
          if (exceedsMaxSize(text)) return;
          if (!text) { setStatusOk('Boş girdi.'); return; }
          const result = parseJsonSafely(text);
          if (!result.ok) {
            const where = (result.line && result.column) ? ` (satır ${result.line}, sütun ${result.column})` : '';
            setStatusErr(`Geçersiz JSON${where}: ${result.error}`);
            return;
          }
          if (exceedsMaxDepth(result.value, settings.maxDepth)) { setStatusErr(`Derinlik sınırı aşıldı: > ${settings.maxDepth}`); return; }
          setStatusOk('Geçerli JSON.');
        }

        function createNodeLabel(keyText, value) {
          const node = document.createElement('span');
          node.className = 'node';
          if (keyText !== null && keyText !== undefined) {
            const keyEl = document.createElement('span');
            keyEl.className = 'key';
            keyEl.textContent = typeof keyText === 'number' ? `[${keyText}]` : keyText;
            node.appendChild(keyEl);
            const colon = document.createElement('span');
            colon.className = 'dim';
            colon.textContent = ': ';
            node.appendChild(colon);
          }

          const t = typeof value;
          let valueEl = document.createElement('span');
          if (value === null) {
            valueEl.className = 'type-null';
            valueEl.textContent = 'null';
          } else if (t === 'string') {
            valueEl.className = 'type-string';
            valueEl.textContent = '"' + value + '"';
          } else if (t === 'number') {
            valueEl.className = 'type-number';
            valueEl.textContent = String(value);
          } else if (t === 'boolean') {
            valueEl.className = 'type-boolean';
            valueEl.textContent = String(value);
          } else if (Array.isArray(value)) {
            const badge = document.createElement('span');
            badge.className = 'badge';
            badge.textContent = `[${value.length}]`;
            node.appendChild(document.createTextNode('[]'));
            node.appendChild(badge);
            return node;
          } else if (t === 'object') {
            const keys = Object.keys(value);
            const badge = document.createElement('span');
            badge.className = 'badge';
            badge.textContent = `{${keys.length}}`;
            node.appendChild(document.createTextNode('{}'));
            node.appendChild(badge);
            return node;
          }
          node.appendChild(valueEl);
          return node;
        }

        function buildTree(value, key, depth = 1) {
          const li = document.createElement('li');
          const isObj = value && typeof value === 'object' && value.constructor === Object;
          const isArr = Array.isArray(value);
          const hasChildren = isObj ? Object.keys(value).length > 0 : (isArr ? value.length > 0 : false);

          if (isObj || isArr) {
            const head = document.createElement('div');
            head.className = 'node';

            const caret = document.createElement('span');
            caret.className = 'caret';
            caret.setAttribute('role', 'button');
            caret.setAttribute('tabindex', '0');
            head.appendChild(caret);

            const label = createNodeLabel(key ?? null, value);
            head.appendChild(label);
            li.appendChild(head);

            const children = document.createElement('ul');
            children.className = 'children';

            if (depth >= settings.maxDepth) {
              const cap = document.createElement('li');
              const capNode = document.createElement('div');
              capNode.className = 'node dim';
              capNode.textContent = '… (derinlik sınırı)';
              cap.appendChild(capNode);
              children.appendChild(cap);
            } else {
              const list = isArr ? value : value;
              const keys = isArr ? value.map((_, i) => i) : Object.keys(list);
              keys.forEach(k => {
                const child = buildTree(list[k], k, depth + 1);
                children.appendChild(child);
              });
            }

            li.appendChild(children);
            if (hasChildren) li.classList.add('expanded');
            caret.addEventListener('click', () => { li.classList.toggle('expanded'); });
            caret.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); li.classList.toggle('expanded'); } });
          } else {
            const line = document.createElement('div');
            line.className = 'node';
            line.appendChild(createNodeLabel(key ?? null, value));
            li.appendChild(line);
          }

          return li;
        }

        function renderTree(value) {
          dom.tree.innerHTML = '';
          const root = buildTree(value, null, 1);
          dom.tree.appendChild(document.createElement('ul')).appendChild(root);
        }

        function expandCollapseAll(expand) {
          const nodes = dom.tree.querySelectorAll('li');
          nodes.forEach(n => {
            if (expand) n.classList.add('expanded'); else n.classList.remove('expanded');
          });
        }

        dom.btnFormat.addEventListener('click', () => formatAction(true));
        dom.btnMinify.addEventListener('click', () => minifyAction());
        dom.btnValidate.addEventListener('click', () => validateAction());
        dom.btnExpand.addEventListener('click', () => { formatAction(false); expandCollapseAll(true); });
        dom.btnCollapse.addEventListener('click', () => { formatAction(false); expandCollapseAll(false); });

        // Girinti ve anahtar sıralama: anında uygula
        dom.indent.addEventListener('change', () => formatAction(true));
        dom.sortKeys.addEventListener('change', () => formatAction(true));

        // Ayarlar aç/kapa
        dom.btnSettings.addEventListener('click', () => openSettings());
        dom.btnCloseSettings.addEventListener('click', () => closeSettings());
        dom.btnSaveSettings.addEventListener('click', () => saveSettingsFromUI());

        dom.input.addEventListener('keydown', (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            formatAction(true);
          }
        });

        // Dosya yükleme
        dom.btnLoad.addEventListener('click', () => dom.fileInput.click());
        dom.fileInput.addEventListener('change', async () => {
          const file = dom.fileInput.files && dom.fileInput.files[0];
          if (!file) return;
          const text = await file.text();
          dom.input.value = text;
          formatAction(true);
          dom.fileInput.value = '';
        });

        // Sürükle-bırak
        ;['dragenter','dragover'].forEach(evt => dom.mainCard.addEventListener(evt, (e) => { e.preventDefault(); e.dataTransfer.dropEffect = 'copy'; }));
        dom.mainCard.addEventListener('drop', async (e) => {
          e.preventDefault();
          const file = e.dataTransfer.files && e.dataTransfer.files[0];
          if (file) {
            const text = await file.text();
            dom.input.value = text;
            formatAction(true);
          }
        });

        // Kaydet
        dom.btnSave.addEventListener('click', () => {
          const text = dom.input.value.trim();
          if (!text) { setStatusErr('Kaydedilecek içerik yok.'); return; }
          const res = parseJsonSafely(text);
          if (!res.ok) { setStatusErr('Geçersiz JSON kaydedilemez.'); return; }
          const space = dom.indent.value === '\t' ? '\t' : Number(dom.indent.value);
          const content = stringify(res.value, space, dom.sortKeys.checked);
          const blob = new Blob([content], { type: 'application/json;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'data.json';
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          setStatusOk('Dosya indirildi: data.json');
        });

        // Kopyala
        dom.btnCopy.addEventListener('click', async () => {
          const txt = dom.raw.textContent || dom.input.value;
          if (!txt) { setStatusErr('Kopyalanacak içerik yok.'); return; }
          try {
            await navigator.clipboard.writeText(txt);
            setStatusOk('Panoya kopyalandı.');
          } catch {
            setStatusErr('Kopyalama başarısız.');
          }
        });

        // Yapıştır
        dom.btnPaste.addEventListener('click', async () => {
          try {
            const txt = await navigator.clipboard.readText();
            if (!txt) { setStatusErr('Panoda metin yok.'); return; }
            dom.input.value = txt;
            formatAction(true);
          } catch {
            setStatusErr('Pano erişimi reddedildi.');
          }
        });

        // Başlangıç
        try {
          if (settings.rememberSession && settings.lastInput) {
            dom.input.value = settings.lastInput;
            formatAction(false);
          } else {
            const example = {
              firstName: "John",
              lastName: "Smith",
              age: 32,
              address: { city: "New York", postalCode: "10021" },
              phoneNumbers: [
                { type: "home", number: "212 555-1234" },
                { type: "fax", number: "646 555-4567" }
              ]
            };
            dom.input.value = JSON.stringify(example, null, 2);
            formatAction(true);
          }
        } catch {}

        // Yumuşak tam ekran (yalnızca JSON kartı)
        let softFull = false;
        function toggleSoftFull() {
          softFull = !softFull;
          document.body.classList.toggle('body-soft-full', softFull);
          dom.mainCard.classList.toggle('fullscreen-card', softFull);
          if (!dom.viewerTree.classList.contains('hidden') || !dom.viewerRaw.classList.contains('hidden')) {
            formatAction(false);
          }
        }
        dom.btnFull.addEventListener('click', toggleSoftFull);

        // Settings helpers
        function applyPalette(key) {
          const pal = colorPalettes[key] || colorPalettes.classic;
          const root = document.documentElement.style;
          root.setProperty('--color-key', pal.key);
          root.setProperty('--color-string', pal.string);
          root.setProperty('--color-number', pal.number);
          root.setProperty('--color-boolean', pal.boolean);
          root.setProperty('--color-null', pal.null);
        }

        function populatePaletteUI() {
          dom.paletteSelect.innerHTML = '';
          Object.keys(colorPalettes).forEach(k => {
            const opt = document.createElement('option');
            opt.value = k; opt.textContent = colorPalettes[k].name;
            if (k === settings.palette) opt.selected = true;
            dom.paletteSelect.appendChild(opt);
          });
          dom.paletteGrid.innerHTML = '';
          Object.keys(colorPalettes).forEach(k => {
            const pal = colorPalettes[k];
            const el = document.createElement('div');
            el.className = 'palette' + (k === settings.palette ? ' active' : '');
            el.innerHTML = `<div class="palette-name">${pal.name}</div><div class="swatches">
              <span class="sw" style="background:${pal.key}"></span>
              <span class="sw" style="background:${pal.string}"></span>
              <span class="sw" style="background:${pal.number}"></span>
              <span class="sw" style="background:${pal.boolean}"></span>
              <span class="sw" style="background:${pal.null}"></span>
            </div>`;
            el.addEventListener('click', () => {
              settings.palette = k; applyPalette(k); saveSettings();
              populatePaletteUI();
            });
            dom.paletteGrid.appendChild(el);
          });
          dom.paletteSelect.addEventListener('change', () => {
            settings.palette = dom.paletteSelect.value; applyPalette(settings.palette); saveSettings(); populatePaletteUI();
          });
        }

        function openSettings() {
          dom.inpMaxDepth.value = String(settings.maxDepth);
          dom.inpMaxSizeKB.value = String(settings.maxSizeKB);
          dom.rememberSession.checked = !!settings.rememberSession;
          dom.paletteSelect.value = settings.palette;
          dom.settingsModal.classList.remove('hidden');
        }
        function closeSettings() { dom.settingsModal.classList.add('hidden'); }

        function saveSettingsFromUI() {
          settings.maxDepth = Math.max(1, Number(dom.inpMaxDepth.value || defaultSettings.maxDepth));
          settings.maxSizeKB = Math.max(10, Number(dom.inpMaxSizeKB.value || defaultSettings.maxSizeKB));
          settings.rememberSession = !!dom.rememberSession.checked;
          settings.palette = dom.paletteSelect.value;
          settings.indent = dom.indent.value;
          settings.sortKeys = dom.sortKeys.checked;
          saveSettings();
          applyPalette(settings.palette);
          closeSettings();
          if (dom.input.value.trim()) formatAction(false);
        }

        function hydrateControlsFromSettings() {
          dom.indent.value = settings.indent;
          dom.sortKeys.checked = !!settings.sortKeys;
        }

        function loadSettings() {
          try {
            const raw = localStorage.getItem('jf_settings');
            if (!raw) return { ...defaultSettings };
            const obj = JSON.parse(raw);
            return { ...defaultSettings, ...obj };
          } catch { return { ...defaultSettings }; }
        }

        function saveSettings() {
          try { localStorage.setItem('jf_settings', JSON.stringify(settings)); } catch {}
        }

        // Hızlı palet dropdown
        function updateQPSwatches() {
          const pal = colorPalettes[settings.palette];
          if (!pal) return;
          dom.qpSwatches.innerHTML = '';
          ['key','string','number','boolean','null'].forEach(k => {
            const s = document.createElement('span');
            s.className = 'qp-sw'; s.style.background = pal[k];
            dom.qpSwatches.appendChild(s);
          });
        }
        function buildQuickPalette() {
          updateQPSwatches();
          dom.qpList.innerHTML = '';
          Object.keys(colorPalettes).forEach(k => {
            const pal = colorPalettes[k];
            const item = document.createElement('div');
            item.className = 'qp-item';
            item.setAttribute('role','menuitem');
            const left = document.createElement('div');
            left.className = 'qp-name'; left.textContent = pal.name;
            const right = document.createElement('div');
            right.className = 'qp-swatches-inline';
            ['key','string','number','boolean','null'].forEach(pk => {
              const sw = document.createElement('span'); sw.className = 'qp-sw'; sw.style.background = pal[pk]; right.appendChild(sw);
            });
            item.appendChild(left); item.appendChild(right);
            if (k === settings.palette) item.style.borderColor = 'var(--accent)';
            item.addEventListener('click', () => {
              settings.palette = k; saveSettings(); applyPalette(k); updateQPSwatches(); buildQuickPalette();
              dom.qpMenu.classList.add('hidden'); dom.qpToggle.setAttribute('aria-expanded','false');
              if (!dom.viewerEdit.classList.contains('hidden')) return;
              if (dom.input.value.trim()) formatAction(false);
            });
            dom.qpList.appendChild(item);
          });
        }
        dom.qpToggle.addEventListener('click', () => {
          const open = !dom.qpMenu.classList.contains('hidden');
          dom.qpMenu.classList.toggle('hidden');
          dom.qpToggle.setAttribute('aria-expanded', String(!open));
        });
        document.addEventListener('click', (e) => {
          if (!e.target.closest || !dom.qpMenu) return;
          const inside = e.target.closest('#quickPalette');
          if (!inside) { dom.qpMenu.classList.add('hidden'); dom.qpToggle.setAttribute('aria-expanded','false'); }
        });
      })();
    </script>
  </body>
  </html>


